## 3.1 Реализация Telegram-бота и интеграций

Telegram-бот в проекте tg-shop-ai является основным пользовательским интерфейсом для клиентских сценариев интернет-магазина. Бот реализован на Python с использованием библиотеки aiogram и обеспечивает обработку команд регистрации, просмотра каталога, оформления заказа, просмотра истории заказов и обращения к AI-помощнику. Набор поддерживаемых команд MVP включает: `/start`, `/catalog`, `/buy <SKU>`, `/myorders`, `/ai <текст>`.  

Логика работы бота построена по принципу «обработчик команды → проверка/валидация → обращение к слою данных → формирование ответа пользователю». Данный подход позволяет изолировать обработку пользовательского ввода от операций хранения данных и обеспечить повторное использование функций доступа к данным в веб-части приложения.

### Интеграция с базой данных
Для хранения данных используется SQLite и ORM SQLAlchemy. Бот взаимодействует с БД через общий слой данных проекта и использует таблицы: `users`, `products`, `orders`, `order_items`, `ai_logs`.  
Команда `/start` выполняет регистрацию пользователя в таблице `users`. Команда `/catalog` извлекает перечень активных товаров из `products` и формирует ответ с идентификаторами (SKU), которые используются при оформлении заказа. Команда `/buy <SKU>` создаёт запись заказа (`orders`) и позицию заказа (`order_items`). Команда `/myorders` запрашивает последние заказы пользователя и отображает их краткую информацию.  

### Интеграция с AI-модулем
Команда `/ai <текст>` передаёт текст запроса в прототип AI-модуля и возвращает пользователю рекомендацию/подсказку. Дополнительно фиксируется журналирование пары запрос-ответ в таблице `ai_logs`, что обеспечивает трассируемость работы интеллектуального компонента и возможность последующего анализа качества подсказок.

Таким образом, Telegram-бот реализует полный контур ключевых клиентских сценариев интернет-магазина и выступает точкой интеграции с общим слоем данных и AI-компонентом, обеспечивая единый источник данных о товарах, заказах и обращениях пользователей.
