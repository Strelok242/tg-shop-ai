## 2.3 Проектирование Telegram-бота и пользовательских сценариев

Telegram-бот является основным пользовательским интерфейсом системы tg-shop-ai и реализует ключевые сценарии интернет-магазина в мессенджере: регистрацию пользователя, просмотр каталога, оформление заказа, просмотр истории заказов и получение подсказок от AI-модуля. Бот построен на библиотеке aiogram и обрабатывает команды пользователя через набор обработчиков, каждый из которых выполняет валидацию входных данных, обращается к слою доступа к данным и формирует ответ.

Логика бота разделена по принципу “тонкий контроллер”: обработчики команд отвечают за взаимодействие с Telegram API и маршрутизацию, а операции с данными (создание заказа, выборка каталога, логирование AI-запросов) вынесены в отдельные функции/репозитории. Такой подход снижает связанность компонентов и упрощает расширение функционала.

Для обеспечения воспроизводимости и контроля целостности данных каждое значимое действие пользователя фиксируется в базе данных: регистрация — в таблице `users`, оформление заказа — в таблицах `orders` и `order_items`, обращение к AI-подсказкам — в таблице `ai_logs`. Состав и назначение команд бота приведены в таблице 2.

**Таблица 2 — Команды Telegram-бота tg-shop-ai**

| Команда | Назначение | Параметры | Результат/ответ | Таблицы БД |
|---|---|---|---|---|
| `/start` | Регистрация пользователя | нет | Приветствие + подтверждение записи в БД | `users` |
| `/catalog` | Просмотр каталога товаров | нет | Список активных товаров (SKU, цена) | `products` |
| `/buy <SKU>` | Оформление заказа | `sku` (обяз.) | Создаёт заказ и позицию, возвращает `order_id`, статус, сумму | `orders`, `order_items`, `products`, `users` |
| `/myorders` | Просмотр заказов пользователя | нет | Список последних заказов пользователя | `orders`, `users` |
| `/ai <текст>` | Подсказка/рекомендация | текст (обяз.) | Рекомендация + инструкция покупки | `ai_logs`, `products`, `users` |
