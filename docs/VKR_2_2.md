## 2.2 Проектирование базы данных

Для обеспечения целостного хранения данных о пользователях, товарах, заказах и результатах работы интеллектуального модуля в системе tg-shop-ai используется реляционная база данных. На этапе прототипирования выбрана SQLite, что позволяет быстро разворачивать окружение и демонстрировать работоспособность без отдельного сервера. Доступ к данным реализуется через ORM SQLAlchemy, что упрощает сопровождение модели и снижает количество “ручного” SQL-кода.

В базе данных выделены следующие основные сущности:

- **User (Пользователь)** — хранит идентификатор Telegram (`tg_id`), имя пользователя (`username`) и время регистрации. Сущность используется как владелец заказов и как источник связи с логами AI-запросов.
- **Product (Товар)** — содержит SKU (уникальный код товара), наименование, описание, цену (в минимальных единицах) и признак активности. Сущность используется для формирования каталога и подстановки цен при создании заказа.
- **Order (Заказ)** — фиксирует факт оформления заказа пользователем: статус, итоговую сумму и время создания. Заказ связан с пользователем отношением “один ко многим”.
- **OrderItem (Позиция заказа)** — содержит ссылки на заказ и товар, количество и цену на момент покупки. Выделение позиций заказа в отдельную таблицу обеспечивает нормализацию данных и поддерживает сценарии расширения (несколько товаров в одном заказе).
- **AiLog (Журнал AI-запросов)** — хранит пары “запрос–ответ” интеллектуального модуля, а также ссылку на пользователя и время создания. Логирование обеспечивает возможность последующего анализа качества подсказок и частоты запросов.

Связи между сущностями формируют логичную структуру: пользователь создаёт заказы, заказ включает одну или несколько позиций, каждая позиция ссылается на конкретный товар; AI-запросы также привязаны к пользователю. Такая модель обеспечивает целостность данных и поддерживает воспроизводимость тестирования, поскольку все ключевые действия пользователя отражаются в базе данных.

На рисунке 3 представлена ER-диаграмма базы данных системы tg-shop-ai, демонстрирующая состав таблиц, атрибуты и связи между сущностями.
